<!DOCTYPE html>

<!--
  Google HTML5 slide template

  Authors: Luke Mahé (code)
           Marcin Wichary (code and design)

           Dominic Mazzoni (browser compatibility)
           Charles Chen (ChromeVox support)

  URL: http://code.google.com/p/html5slides/
-->

<html>
  <head>
    <title>Testing</title>

    <meta charset='utf-8'>
    <script
      src='assets/slides.js'></script>
    <script
      src='assets/jquery.js'></script>
    <script
      src='assets/underscore.js'></script>
    <script
      src='assets/backbone.js'></script>
    <script>
      $(document).ready(function () {
        $('button.run').click(function () {
          var code = '(function () {' + ($(this).parents('article').find('pre').text()) + '}).call(this)';
          eval(code);
        });
      });
    </script>

    <link rel="stylesheet" href="assets/css/styles.css">
    
    <style>
    /* Your individual styles here, or just use inline styles if that’s
       what you want. */
      
    * {font-family: "Bitstream Vera Sans Mono",courier, monospace;} 
    #title {margin-left: 80px; margin-top: 170px; overflow: hidden; font-size: 50%; line-height: 120%; background: white; border: 0px; white-space: pre; color: black}
      
table {width: 400px; float: right; margin-bottom: 1em;}
th {text-align: left;}
pre {clear: both;}

/* * {font-family: 'lucida grande', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', helvetica, sans-serif;}*/
#content, #postamble {margin: auto; width: 38em;}

h2 { font-size: 1em; font-weight: bold; }
h2:before {content: " * "}
h3 { font-size: 1em; font-weight: bold}
h3:before {content: " * "}
#title,pre {background: white; border: 0px; font-family: "Bitstream Vera Sans Mono",courier, monospace;} 

a, a:visited {
    color: black !important;
    text-decoration: none;
    font-weight: bold;
    }
p { text-align: justify; /*margin-bottom: 2em; margin-top: 2em;*/}
pre.code, pre.example {border: 2px dashed black}
ul {list-style-type:none}
ul li:before { content: "+ "; color: black;}
#postamble p {
margin: 0px;
}


    article {
      padding-top: 2em !important;
    }

    .section {
    text-align: center;
    font-weight: bold;
    text-size: 300%;
    margin: 0.6em;
    }
      

    .centered {
    text-align: center;
    }


    ol li::before {
      content: '';
    }


    pre.compact {
    margin: 0; text-size: 80%; line-height: 80%
    }

    .run {
      float: right;
    }

    #todo-items {
    text-align: center;
    margin: 2em;
    }
      
    #todo-items .done-true {
    text-decoration: line-through;
    }

    a.profile:before {
      content: "";
    }
    a.profile:after {
      content: "";
    }
    </style>
  </head>

  <body>

    <section class='slides layout-regular '>
      
      <!-- Your slides (<article>s) go here. Delete or comment out the
           slides below. -->
        
        
      
      <article>
        <div id="title">
    _   _              _    ___  _            _     _                  _
   /_\ | |_ __  ___ __| |_ / _ \| |__ ___ ___| |___| |_ ___   _ _  ___| |_
  / _ \| | '  \/ _ (_-&lt;  _| (_) | '_ (_-&lt;/ _ \ / -_)  _/ -_)_| ' \/ -_)  _|
 /_/ \_\_|_|_|_\___/__/\__|\___/|_.__/__/\___/_\___|\__\___(_)_||_\___|\__|
        </div>
        <center>
          <div>
            Testing a large client-side JavaScript project
          <!-- Formatting with BR tags, I rule! -->
          <br/>
          <br/>
          Thomas W Parslow 
          <br/>
          <br/>
          tom@almostobsolete.net 
          <br/>
          @almostobsolete 
          <br/>
          http://almostobsolete.net
          </div>
        </center>
      </article>

      <!-- INTRODUCTION -->


      <article>
        <h3>
          Client Side JavaScript Testing
        </h3>
        <p>
          <ul>
            <li>
              Manual Tests and QA
            </li>
            <li>
              Automated Tests
              <ul>
                <li>
                  Unit Tests
                </li>
                <li>
                  Integration Tests
                </li>
              </ul>
            </li>
          </ul>
        </p>
      </article>

      <article>
        <h3>
          Integration Tests
        </h3>
        <p>
          <ul>
            <li>
              Testing client and server parts together
            </li>
            <li>
              Use it like a user will, and check the results are as
              expected
            </li>
          </ul>
        </p>
      </article>


      <article>
        <h3>
          Why use Integration Tests
        </h3>
        <p>
          <ul>
            <li>
              Tests what really matters
            </li>
            <li>
              Catches bugs that might otherwise fall between the
              cracks
            </li>
          </ul>
        </p>
      </article>
      
      
      <article>
        <h3>
          Downsides of Integration Tests
        </h3>
        <p>
          <ul>
            <li>
              Slower to run
            </li>
            <li>
              Harder to pin down source of problems
            </li>
            <li>
              Doesn't help improve code quality as much.
            </li>
          </ul>
        </p>
      </article>

      <article>
        <h3>
          How?
        </h3>
        <p>
          <ul>
            <li>
              Need a browser enviroment
            </li>
            <li>
              Need to be able to run it easily
            </li>
            <li>
              Must be able to collate results
            </li>
          </ul>
        </p>
      </article>

      <article>
        <h3>
          Approaches
        </h3>
        <p>
          <ul>
            <li>
              Real Browser
            </li>
            <li>
              Simulated Browser (PhantomJS)
            </li>
            <li>
              Not mentioned in this talk: Normal Browser plus remote control (Selenium) 
            </li>
          </ul>
        </p>
      </article>

      <article>
        <h3>
          Simulated Browser: PhantomJS
        </h3>
        <p>
          <div class="left" style="float: left; margin: 2em; text-align:center;">
            <img   src="assets/images/phantomjs.png"/>
            <br>
            <a href="http://phantomjs.org/">phantomjs.org</a>
          </div>
          <ul>
            <li>It's like a full browser!</li>
            <li>Based on Webkit, like Chrome and Safari</li>
            <li>But headless</li>
          </ul>
        </p>
          <pre style="font-size:80%;line-height: 100%;">
console.log('Loading a web page');
var page = new WebPage();
var url = "http://www.phantomjs.org/";
page.open(url, function (status) {
    //Page is loaded!
    phantom.exit();
});
          </pre>
      </article>
      

      <article>
        <h3>
          CasperJS
        </h3>
        <img class="centered" style="float: none; margin: 2em" src="assets/images/casperdemo.png"/>
        <p>
          <ul>
            <li>A framework built on PhantonJS for testing</li>
            <li>Includes assertions and methods for interacting with and waiting for stuff running on the page</li>
          </ul>
        </p>
      </article>

      <article>
        <h3>
          CasperJS
        </h3>
        <p>
          <ul>
            <li>
              PRO: Runs from the console, fits into workflows
            </li>
            <li>
              PRO: Easy to run anywhere
            </li>
            <li>
              CON: Not actually a real browser
            </li>
            <li>
              CON: A pain to Debug, no Web Developer Tools for you!
            </li>
          </ul>
        </p>
      </article>

      <article>
        <h3>
          Real Browser
        </h3>
        <p>
          <ul>
            <li>
              The user use's one, so why not the tests?
            </li>
            <li>
              Use your standard tools for debugging
            </li>
            <li>
              Can test on lots of browsers (fancy running your tests
              on an iPad?)
            </li>
          </ul>
        </p>
      </article>
      
      
      <article>
        <h3>
          Mocha's Browser Test Runner
        </h3>
        <img class="centered" style="float: none; margin: 2em" src="assets/images/mocha.png"/>
        <p>
          <ul>
            <li>
              Allows Mocha tests to be run in the browser
            </li>
            <li>
              Provides visual output for test progress &amp; results
            </li>
          </ul>
        </p>
      </article>
      
      <article>
        <h3>
          Integration Tests with Mocha
        </h3>
        <p>
          <ul>
            <li>
              <b>Problem:</b> Isolation
            </li>
            <li>
              <b>Solution:</b> IFrames!
            </li>
          </ul>
        </p>
      </article>

      <article>
        <h3>
          IFrame's for app isolation
        </h3>
        <p>
          <ul>
            <li>
              For each test: Create IFrame, load app within it
            </li>
            <li>
              After test destroy the IFrame
            </li>
            <li>
              Provides isolation, the app can believe it's the only thing running.
            </li>
            <li>
              JS in same origin IFrames can communicate with parent.
            </li>
          </ul>
        </p>
      </article>

      <article>
        <h3>
          The Test Server
        </h3>
        <p>
          <ul>
            <li>
              Serves up the app and the test scripts
            </li>
            <li>
              Ours is written in Node.JS
            </li>
            <li>
              ...but you could use MAMP or whatever
            </li>
            <li>
              Our build script can run the test server after building
            </li>
          </ul>
        </p>
      </article>
      
      
      <article>
        <h3>
          Demo: Integration tests in Mocha
        </h3>
        <p>
          <ul>
            TODO
          </ul>
        </p>
      </article>

      <article>
        <h3>
          Integrating with tools
        </h3>
        <p>
          <ul>
            <li>
              <b>Problem:</b> doesn't integrate well with other tools
            </li>
            <li>
              <b>Soltuion:</b> report results back to test server
            </li>
          </ul>
        </p>
      </article>

      <article>
        <h3>
          Test reporting
        </h3>
        <p>
          <ul>
            <li>
              A custom mocha test reporter reports back to server via an AJAX call
            </li>
            <li>
              Scripts can poll the server for results
            </li>
          </ul>
        </p>

        <pre>
{
    "complete": true,
    "results": {
        title: "gets the model attribute for each binding and set it to the form",
        fullTitle: "BaseFormBindingView updateForm gets the model attribute for each binding and set it to the form",
        duration: "1",
        state: "pass"
    },
    ...
}
        </pre>
      </article>
      
      <article>
        <h3>
          Back to Phantom
        </h3>
        <p>
          <ul>
            <li>
              PhantomJS had some great benefits!
            </li>
            <li>
              Now we have tests that run in any browser, including PhantomJS!
            </li>
            <li>
              Reports back via the AJAX mechanism.
            </li>
          </ul>
        </p>
      </article>

      <article>
        <h3>
          Continuous Integration (CI)
        </h3>
        <p>
          <ul>
            <li>
              A server that automatically runs all your tests
            </li>
            <li>
              Checks out every commit and tests, reports back results
            </li>
            <li>
              Makes sure tests are run and reduces issues with "Works on my machine"
            </li>
          </ul>
        </p>
      </article>
      
      
      <article>
        <h3>
          CircleCI: CI as a service
        </h3>
        <p>
          <ul>
            <li>
              CI can be a pain to set up
            </li>
            <li>
              CircleCI handles a lot of that pain for you
            </li>
            <li>
              Plus it integrates with GitHub.
            </li>
          </ul>
        </p>
      </article>
      
      <article>
        <h3>
          Fully Automated Real Browsers
        </h3>
        <p>
          <ul>
            <li>
              Fully automatic AND real browsers?
            </li>
            <li>
              Enter BrowserStack (see Demo)
            </li>
            <li>
              Simple API allows VMs to be started with a wide veriety
              of OSs and Browsers
            </li>
          </ul>
        </p>
      </article>
      
      <article>
        <h3>
          Demo: Tests multiple real browsers automatically on every commit!
        </h3>
        <p>
          <ul>
          
          </ul>
        </p>
      </article>
      
    </section>

    
<script src="http://static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">clicky.init(227423);</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="http://in.getclicky.com/227423ns.gif" /></p></noscript>

<script>
  var hash = document.location.hash;
  function track() {
    if(hash !== document.location.hash) {
      hash = document.location.hash;
      if (hash != '#1') {
        clicky.log( document.location.pathname + document.location.hash.slice(1), 'SLIDE ' + document.location.hash + ' - ' + document.title, 'pageview' )
      }
    }
  }
  window.addEventListener("hashchange", track, false);
</script>
  </body>
</html>
